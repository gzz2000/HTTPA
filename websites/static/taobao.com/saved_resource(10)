define("kg/search-suggest/6.3.1/index",["kg/combobox/6.2.7/index","base","util","node","io","json","event","cookie","dom","ua"],function(e,t,n){var r,i,o,a,s,u,c,l,f,d,h,p=e("kg/combobox/6.2.7/index"),g=e("base"),m=e("util"),v=e("node"),y=e("io"),_=e("json"),b=e("event"),x=(e("cookie"),e("dom")),C=e("ua");r=function(e){function t(e){t.superclass.constructor.call(this,e||{})}var n=p;return t=n.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,n=t.constructor.superclass.sendRequest;if(t.fire("beforeQueryChange",{query:e})===!1)return!1;t.queryTimer&&clearTimeout(t.queryTimer),t.laterTimer&&clearTimeout(t.laterTimer);var r=arguments;t.queryTimer=setTimeout(function(){t.queryTimer=null,t.laterTimer=setTimeout(function(){t.later=!1},500),n.apply(t,r)},t.later?200:50),t.later=!0},handleKeyDownInternal:function(e){var t=this,n=t.constructor.superclass.handleKeyDownInternal;return t.fire("beforeKeyDown",{event:e})!==!1&&void n.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,n=t.constructor.superclass.handleKeyEventInternal;return t.fire("beforeKeyDown",{event:e})!==!1&&void n.apply(this,arguments)},setValueInternal:function r(e){var t=this,r=t.constructor.superclass.setValueInternal;return t.fire("beforeSetInputValue",{event:e})!==!1&&void r.apply(this,arguments)},setValueFromAutocomplete:function i(e){var t=this,i=t.constructor.superclass.setValueFromAutocomplete,n=t.constructor.superclass.setCurrentValue;return t.fire("beforeSetInputValue",{event:e})!==!1&&void(i||n).apply(this,arguments)},renderItems:function(e,t,n){var r,i,o=this,a=o.get("sugConfig").resultFormat,s=o.resultArr||(o.resultArr=[]),u="",c=e;KISSY.each(t,function(e,o){if(!e||!e[0])return void t.splice(o,1);for(r=e[0];r.indexOf(c)<0;)c=c.substr(0,c.length-1);""===c?(u=r,r=""):0===r.indexOf(c)&&(u=c,r=r.replace(c,""));for(var l in s)if(i=s[l],i.textContent===e[0]&&i.unique)return;n=n.replace("{format}",a),s.push({textContent:e[0],content:KISSY.substitute(n,{query:u,text:r,index:o+1,count:e[1]}),list:!0})}),o.resultArr=s},alignInternal:function o(e){var t=this,o=t.constructor.superclass.alignInternal;return t.fire("beforeShow",{event:e})!==!1&&void o.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),t.RemoteDataSource=n.RemoteDataSource,t.LocalDataSource=n.LocalDataSource,e=t}(),i=function(e){return e={"new":{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-xp" data-key="q={$queryUrl}&suggest=new_{$index}&tab=shopping&auction_tag[]=1154"><span class="{prefixCls}menu-xp-tag">\u65b0\u54c1</span><span class="{prefixCls}menu-xp-icon">\u65b0\u54c1</span><span class="{prefixCls}menu-xp">\u201c{$query}\u201d\u76f8\u5173{new}\u65b0\u54c1</span></div>'},shop:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-action="//shopsearch.taobao.com/search" data-key="q={$queryUrl}&suggest=shop_{$index}"><span class="{prefixCls}menu-dp">{$query} <b>\u76f8\u5173\u5e97\u94fa</b></span><span class="{prefixCls}menu-dp-icon">\u5e97\u94fa</span></div>'},cat:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$3}&cat={$1}&suggest=cat_{$index}"><span class="{prefixCls}menu-key">{$2}</span><span class="{prefixCls}menu-cate">\u5728<b>{$0}</b>\u5206\u7c7b\u4e0b\u641c\u7d22</span></div>'},list:{tmpl:"<div data-index='{index}' class='item-wrapper' data-key='q={textContent}&suggest=0_{index}'><span class='item-text'>{query}<b>{text}</b></span><span class='item-count'>{format}</span></div>"},global:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$queryUrl}&promote=2097152&suggest=global_{$index}"><span class="{prefixCls}menu-key">{$query}</span><span class="{prefixCls}menu-cate">\u5728\u5168\u7403\u8d2d\u5e02\u573a\u4e2d\u641c\u7d22</span></div>'},history:{tmpl:'<div class="{prefixCls}menu-extras-history" {attr} data-key="q={historyItemQuery}&suggest={extraParam}_{index}" data-index="_his_{index}" data-value="{historyItemValue}"><span class="{prefixCls}menu-history-key">{historyItemValue}</span><a data-type="{extraParam}" class="{prefixCls}menu-history-delete">\u5220\u9664</a></div>'},scene:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-scene" data-action="//fa.taobao.com/search" data-key="q={scene}&suggest=scene_{$index}"><span class="{prefixCls}menu-key">{scene}</span><b>\u88c5\u4fee\u5b9d\u5178/\u9009\u8d2d\u79d8\u7c4d</b></div>'},dapei_bottom:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-source-stat="source_click=suggest_kfc&source_pv=suggest_kfc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_bottom}"><span class="{prefixCls}menu-dp">{dapei_bottom}<b>\u5168\u5957\u642d\u914d</b></span></div>'},dapei_top:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-source-stat="source_click=suggest_jqc&source_pv=suggest_jqc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_top}"><span class="{prefixCls}menu-key">{dapei_top}</span><span class="{prefixCls}menu-cate">\u5728<b>\u642d\u914d</b>\u4e0b\u641c\u7d22</span></div>'},tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>\u5929\u732b\u76f8\u5173</b></div>'},c2c_activity:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-active" data-key="q={c2c_activity_query} {c2c_activity_tag}&suggest=active_{$index}"><span class="{prefixCls}menu-key">{c2c_activity_query}</span><span class="{prefixCls}menu-cate">\u5728 <b>{c2c_activity_tag}</b> \u4e2d\u641c\u7d22</span></div>'},channelEntry:{tmpl:'<div class="{prefixCls}menu-channel-entry"><a href="{channelEntry_url}" class="channel-bg" style="background-image:url({channelEntry_img});background-color:{channelEntry_bgColor}"><span class="channel-prefix"></span><span>{channelEntry_title}</span></a></div>'},showExtra:!1}}(),o=function(e){function t(e){return n?n:(t.superclass.constructor.call(this,e||{}),void(n=this))}var n,r=g,i=m;return i.extend(t,r,{pluginInitializer:function(e){var t=this;t.set("caller",e)},getCookie:function(e){var t=window;if(t.userCookie&&!i.isUndefined(t.userCookie[e]))return t.userCookie[e];if(t.SRP_COOKIES||(t.SRP_COOKIES={})&&i.isUndefined(SRP_COOKIES[e])){var n=document.cookie.match("(?:^|;)\\s*"+e+"=([^;]*)");n&&n[1]?SRP_COOKIES[e]=decodeURIComponent(n[1]):SRP_COOKIES[e]=""}return SRP_COOKIES[e]},fireEvent:function(e,t){var n=document;if(n.createEvent){var r=n.createEvent("MouseEvents");r.initEvent(t,!0,!1),e.dispatchEvent(r)}else n.createEventObject&&e.fireEvent("on"+t)}},{ATTRS:{pluginId:{value:"utils"}}}),e=t}(),a=function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};return!function(r){function i(){}function o(e,t){return function(){e.apply(t,arguments)}}function a(e){if("object"!=t(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(e,this)}function s(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void a._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null===n)return void(1===e._state?u:c)(t.promise,e._value);var r;try{r=n(e._value)}catch(i){return void c(t.promise,i)}u(t.promise,r)}))}function u(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==("undefined"==typeof n?"undefined":t(n))||"function"==typeof n)){var r=n.then;if(n instanceof a)return e._state=3,e._value=n,void l(e);if("function"==typeof r)return void d(o(r,n),e)}e._state=1,e._value=n,l(e)}catch(i){c(e,i)}}function c(e,t){e._state=2,e._value=t,l(e)}function l(e){2===e._state&&0===e._deferreds.length&&a._immediateFn(function(){e._handled||a._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)s(e,e._deferreds[t]);e._deferreds=null}function f(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function d(e,t){var n=!1;try{e(function(e){n||(n=!0,u(t,e))},function(e){n||(n=!0,c(t,e))})}catch(r){if(n)return;n=!0,c(t,r)}}var h=setTimeout;a.prototype["catch"]=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var n=new this.constructor(i);return s(this,new f(e,t,n)),n},a.all=function(e){var n=Array.prototype.slice.call(e);return new a(function(e,r){function i(a,s){try{if(s&&("object"==("undefined"==typeof s?"undefined":t(s))||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(e){i(a,e)},r)}n[a]=s,0===--o&&e(n)}catch(c){r(c)}}if(0===n.length)return e([]);for(var o=n.length,a=0;a<n.length;a++)i(a,n[a])})},a.resolve=function(e){return e&&"object"==("undefined"==typeof e?"undefined":t(e))&&e.constructor===a?e:new a(function(t){t(e)})},a.reject=function(e){return new a(function(t,n){n(e)})},a.race=function(e){return new a(function(t,n){for(var r=0,i=e.length;r<i;r++)e[r].then(t,n)})},a._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){h(e,0)},a._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},a._setImmediateFn=function(e){a._immediateFn=e},a._setUnhandledRejectionFn=function(e){a._unhandledRejectionFn=e},"undefined"!=typeof n&&n.exports?e=a:r.Promise||(r.Promise=a)}(void 0),e}(),s=function(e){return e={},!function(t){function r(e,t){t=t||{},this._id=r._generateUUID(),this._promise=t.promise||Promise,this._frameId=t.frameId||"CrossStorageClient-"+this._id,this._origin=r._getOrigin(e),this._requests={},this._connected=!1,this._closed=!1,this._count=0,this._timeout=t.timeout||5e3,this._listener=null,this._installListener();var n;t.frameId&&(n=document.getElementById(t.frameId)),n&&this._poll(),n=n||this._createFrame(e),this._hub=n.contentWindow}r.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},r._getOrigin=function(e){var t,n,r;return t=document.createElement("a"),t.href=e,t.host||(t=window.location),n=t.protocol&&":"!==t.protocol?t.protocol:window.location.protocol,r=n+"//"+t.host,r=r.replace(/:80$|:443$/,"")},r._generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})},r.prototype.onConnect=function(){var e=this;return this._connected?this._promise.resolve():this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(this._requests.connect||(this._requests.connect=[]),new this._promise(function(t,n){var r=setTimeout(function(){n(new Error("CrossStorageClient could not connect"))},e._timeout);e._requests.connect.push(function(e){return clearTimeout(r),e?n(e):void t()})}))},r.prototype.set=function(e,t){return this._request("set",{key:e,value:t})},r.prototype.get=function(){var e=Array.prototype.slice.call(arguments);return this._request("get",{keys:e})},r.prototype.del=function(){var e=Array.prototype.slice.call(arguments);return this._request("del",{keys:e})},r.prototype.clear=function(){return this._request("clear")},r.prototype.getKeys=function(){return this._request("getKeys")},r.prototype.close=function(){var e=document.getElementById(this._frameId);e&&e.parentNode.removeChild(e),window.removeEventListener?window.removeEventListener("message",this._listener,!1):window.detachEvent("onmessage",this._listener),this._connected=!1,this._closed=!0},r.prototype._installListener=function(){var e=this;this._listener=function(t){var n,r,i,o;if(!e._closed&&t.data&&"string"==typeof t.data&&(r="null"===t.origin?"file://":t.origin,r===e._origin))if("cross-storage:unavailable"!==t.data){if(-1!==t.data.indexOf("cross-storage:")&&!e._connected){if(e._connected=!0,!e._requests.connect)return;for(n=0;n<e._requests.connect.length;n++)e._requests.connect[n](i);delete e._requests.connect}if("cross-storage:ready"!==t.data){try{o=JSON.parse(t.data)}catch(a){return}o.id&&e._requests[o.id]&&e._requests[o.id](o.error,o.result)}}else{if(e._closed||e.close(),!e._requests.connect)return;for(i=new Error("Closing client. Could not access localStorage in hub."),n=0;n<e._requests.connect.length;n++)e._requests.connect[n](i)}},window.addEventListener?window.addEventListener("message",this._listener,!1):window.attachEvent("onmessage",this._listener)},r.prototype._poll=function(){var e,t,n;e=this,n="file://"===e._origin?"*":e._origin,t=setInterval(function(){return e._connected?clearInterval(t):void(e._hub&&e._hub.postMessage("cross-storage:poll",n))},1e3)},r.prototype._createFrame=function(e){var t,n;t=window.document.createElement("iframe"),t.id=this._frameId;for(n in r.frameStyle)r.frameStyle.hasOwnProperty(n)&&(t.style[n]=r.frameStyle[n]);return window.document.body.appendChild(t),t.src=e,t},r.prototype._request=function(e,t){var n,r;return this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(r=this,r._count++,n={id:this._id+":"+r._count,method:"cross-storage:"+e,params:t},new this._promise(function(e,t){var i,o,a;i=setTimeout(function(){r._requests[n.id]&&(delete r._requests[n.id],t(new Error("Timeout: could not perform "+n.method)))},r._timeout),r._requests[n.id]=function(o,a){return clearTimeout(i),delete r._requests[n.id],o?t(new Error(o)):void e(a)},Array.prototype.toJSON&&(o=Array.prototype.toJSON,Array.prototype.toJSON=null),a="file://"===r._origin?"*":r._origin,r._hub.postMessage(JSON.stringify(n),a),o&&(Array.prototype.toJSON=o)}))},"undefined"!=typeof n&&n.exports?e=r:"undefined"!=typeof e?e.CrossStorageClient=r:"function"==typeof define&&define.amd?define([],function(){return r}):t.CrossStorageClient=r}(void 0),e}(),u=function(e){var t=g,n=v,r=y,i=document.inputEncoding||document.characterSet||document.charset||"none";return i=i.toLowerCase(),e=t.extend({initializer:function(){var e=this.get("node");if(!e)throw new Error("Placeholder config.node \u53c2\u6570\u4e3a\u7a7a!");this.el=n.all(e),this.el&&(this.el.addClass("search-combobox-placeholcer"),this.render())},render:function(){var e=this;r({url:e.get("api"),dataType:"jsonp",success:function(t){var n=t.result;if(n&&n.show&&n.search)e.generatorLabel(n);else{var r=e.el.find("label");r&&r.length>0&&r.css({visibility:"visible"})}},error:function(){var t=e.el.find("label");t&&t.length>0&&t.css({visibility:"visible"})}})},generatorLabel:function(e){var t=this,n="<span>"+e.search+"</span>"+e.show,r='<label for="q" data-searchtype-item="'+n+'" >'+n+"</label>";t.el.html(r);var i=t.el.one("label");t.set("label",i),t.fire("placeholder:complete")}},{ATTRS:{api:{value:"//suggest.taobao.com/sug?area=shade_recommand&code="+i},node:{value:null},label:{value:null}}})}(),c=function(e){function t(e){t.superclass.constructor.call(this,e||{})}var n=g,r=o,i=m;return i.extend(t,n,{getBucket:function(){var e=this,t=e.getCookieT(),n=e.getTestBucket()||e.retBucket(t,20,-4,4)-0;return n},getTestBucket:function(){var e=location.search,t=e.match(/alg_bts=(\d+)/);if(t&&t[1])return t[1]-0},getCookieT:function(){var e=new r,t=e.getCookie("t");return t},retBucket:function(e,t,n,r){return e?this.countBucket(e,t,n,r):"0"},countBucket:function(e,t,n,r){var i=e.substr(n,r),o=parseInt(i,16),a=o%t+1;return a+""}},{ATTRS:{pluginId:{value:"bts"}}}),e=t}(),l=function(e){function t(e){return n||(t.superclass.constructor.call(this,e||{}),n=this,n.initialize()),n}var n,r=g,i=_,o=m,u=a,c=s;return o.extend(t,r,{initialize:function(e){this.makeCompatible(),this.initStorage()},makeCompatible:function(){window.__StorageIsReady=function(){KISSY.log("[warning]: not use flash any more, you can remove `window.__StorageIsReady()` call, see: https://aone.alibaba-inc.com/task/12460577")}},initStorage:function(){this.storage=new c("https://www.taobao.com/markets/search/search-suggest-history-iframe",{promise:u})},save:function(e,t,n){n&&n.onFailure&&n.onFailure()},read:function(e,t,n){t&&t.onFailure&&t.onFailure()},writeAsync:function(e,t){var n=this.storage;return n.onConnect().then(function(){var r=i.stringify(t);return n.set(e,r)})},onReady:function(){return this.storage.onConnect()},readAsync:function(e){var t=this.storage;return t.onConnect().then(function(){return t.get(e)}).then(function(e){var t;try{t=i.parse(e)}catch(n){}return t})}}),e=t}(),f=function(e){function t(e){t.superclass.constructor.call(this,e||{}),this.initialize()}var n=g,r=m,i=l,o=7,a=100,s="suggest_history_";return r.extend(t,n,{initialize:function(){var e=this,t=e.get("name"),n=e.get("tab"),r=e.get("user");"item"===n&&(n="baobei"),e.storageKey=s+t+n+r,e._initStorage(),e.loadHistory()},_setKey:function(e){var t=this,n=e.name||t.get("name"),r=e.tab||t.get("tab"),i=e.user||t.get("user");"item"===r&&(r="baobei"),t.storageKey=s+n+r+i,t.set("tab",r),t.set("name",n),t.set("user",i)},_initStorage:function(){var e=this.get("storageType");switch(e){case"flashStorage":KISSY.log("`storageType=flashStorage`, flash \u5df2\u4e0b\u7ebf\uff0c\u4f7f\u7528 iframe localStorage \u652f\u6301"),this.storage=this._initFlashStorage();break;default:this.storage=this._initIframeStraoge()}},_initFlashStorage:function(){return this._initIframeStraoge()},_initIframeStraoge:function(){var e=this;return{save:function(){return(new i).writeAsync(e.storageKey,e.getDataList())},read:function(){return(new i).readAsync(e.storageKey)},onReady:function(){return(new i).onReady()}}},checkFlash:function(e){this.storage.onReady().then(e&&e.onSuccess,e&&e.onFailure)},loadHistory:function(){var e=this;return this.storage.read().then(function(t){e.setDataList(t),e.translateCn2Pinyin(t)})},translateCn2Pinyin:function(e){e=e||[];for(var t=[],n=0,i=e.length;n<i;n++){var o=e[n],a=/[\u4e00-\u9fa5]/,s=decodeURIComponent(o.value);a.test(s)&&t.push(s)}var u=",,,";if(t.length){this.__cnList=t,this.__cnSep=u,KISSY.suggestHistoryJSONP=r.bind(this._mergeCnPinyin,this);var c=location.protocol+"//suggest.taobao.com/sug?code=utf-8&area=py&callback=KISSY.suggestHistoryJSONP&q="+t.join(u);KISSY.getScript(c)}},_mergeCnPinyin:function(e){var t=this;if(e&&e.result){var n=e.result[0]||"",i=n.split(this.__cnSep);if(this.__cnList&&i.length===this.__cnList.length){var o={};r.each(this.__cnList,function(e,n){o[t.__cnList[n]]=i[n]});for(var a=this.getDataList(),s=0,u=a.length;s<u;s++){var c=a[s],l=decodeURIComponent(c.value);o[l]&&(c.value=o[l])}this.setDataList(a)}}},purge:function(e){for(var t=[],n=r.now()-24*o*3600*1e3,i=0,s=e.length;i<s;i++){var u=e[i];u.time>n&&t.push(u)}return t.sort(function(e,t){return t.time-e.time}),t.length>a&&(t.length=a),t=this._distinctByValue(t)},getDataList:function(){var e=this._datalist||[];return e.concat()},setDataList:function(e){e=this.purge(e||[]),this._datalist=e.concat()},addTobeSavedList:function(e,t){if(!e.match(/<>'"/)&&!t.match(/<>'"/)){var n=this.getDataList(),i={key:encodeURIComponent(e),value:encodeURIComponent(t),time:r.now()};n.unshift(i),this.setDataList(n)}},_distinctByValue:function(e){for(var t,n=[],r=0,i=e.length;r<i;r++)t=e[r],t.value.match(/%3C|%3E|[<>'"]/g)||this._hasItemOfValue(n,t.value)||n.push(t);return n},_hasItemOfValue:function(e,t){for(var n=!1,r=e.length-1;r>=0;r--)e[r].value===t&&(n=!0);return n},save:function(e,t){""!==t&&(this.addTobeSavedList(e,t),this.storage.save())},query:function(e){var t=this.getDataList();if(e){e=encodeURIComponent(e);var n,i,o=[];return r.each(t,function(t){n=t.key,i=t.value,0!==n.indexOf(e)&&0!==i.indexOf(e)||o.push(t)}),o}return t},deleteItem:function(e){for(var t=this.getDataList(),n=encodeURIComponent(e),r=[],i=0,o=t.length;i<o;i++){var a=t[i];a.key!=n&&r.push(a)}this.setDataList(r),this.storage.save()},destructor:function(){this._datalist=null,s=null},clearByDay:function(){},hasHistory:function(){},_query:function(e){},_deleteItemByValue:function(e,t){}},{ATTRS:{name:{value:"default",setter:function(e){return e}},user:{value:"",setter:function(e){return r.fromUnicode(e)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(e){return e},getter:function(e){return e}}}}),e=t}(),d=function(e){function t(e){t.superclass.constructor.call(this,e||{})}var n=g,r=m,i=b,o=f;return r.extend(t,n,{pluginInitializer:function(e){var t=this,n=t.get("stat");t.set("caller",e),e.on("beforeSubmit",function(e){var n=e.isInitSearch;t.setStat(n)}),n&&(t.sendTongji(),t.bindSearchTrace())},bindSearchTrace:function(){var e=this;i.delegate("body","click","a",e.initSearchTrace,e)},initSearchTrace:function(e){var t=this,n=e.currentTarget,r=n.getAttribute("trace"),i=n.getAttribute("href");if(r)switch(r){case"relatedSearch":t.saveQuery();break;case"auction":var o=t.stat;o&&i.indexOf("initiative_new")===-1&&n.setAttribute("href",i+"&initiative_new=1")}},sendTongji:function(){var e,t=this,n=t.getStatInst();n.checkFlash({onSuccess:function(){e=n.query("stat")[0],e&&e.value&&(t.stat=e.value,t.send("f_stats_show="+e.value,!0))}})},setStat:function(e,t){var n=this,r=n.get("caller"),i=r.query,o=n.saveQuery(i,e);o&&n.send("lf_aclog=null-null-null-null-0&stats_click="+o,t)},getStatInst:function(){var e=this,t=e.get("caller"),n=t.get("sugConfig"),r=n.tab||"",i=new o({name:"stat",tab:r});return i},saveQuery:function(e,t){var n,r,i=this.getStatInst();return t&&e?(n=encodeURIComponent(e),r="initiative_new:1;q:"+n,i.save("stat",r)):i.deleteItem("stat"),r},send:function(e,t){var n,r,i=this.get("logTypes");t?(i=this.get("tongjiKey"),n=i.logkey,r=i.chksum):(i=this.get("pvKey"),n=i.logkey,r=i.chksum),window.goldlog?goldlog.record(n,"",e,r):(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[n,"",e,r]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"},tongjiKey:{value:{logkey:"/tongji",chksum:"H51884970"}},pvKey:{value:{logkey:"/search",chksum:"H51884969"}}}}),e=t}(),h=function(e){function t(e){for(var t="",n=0;n<e.length;++n){var r=e.charCodeAt(n).toString(16).toUpperCase();t+="\\u"+"0000".substr(r.length)+r}return t}var n=v,a=g,s=x,l=m,f=r,h=i,p=c,y=o,_=d,b=C,S=null,k=u,w=a.extend({initializer:function(){var e=this,t=e.get("placeholder");if(e.hongbaoConfig=e.get("hongbao")||{},e.hongbaoConfig.open&&KISSY.Config.packages&&KISSY.Config.packages.hbhub&&(!b.ie||b.ie>=8)){var n=e.hongbaoConfig.query||"";KISSY.use("hbhub/index",function(t,r){S=r,e.hongbaoConfig.init&&setTimeout(function(){S.init(n)},150)})}t.show&&e._initPlaceholder(t),e._initCombo(),e.bindUtil()},bindUtil:function(){var e=this;e.Utils=new y,e.Stat=new _(e.get("statConfig"))},_setComboCache:function(e){var t=this,n=t.get("tab");t.configArr=t.configArr||[],t.configArr[n]={data:e}},_checkHasTab:function(){var e=this,t=e.getPlugin("tab");t||(e.tabNode=e.get("form"))},_initPlaceholder:function(e){var t=this;t.placeholder=new k(e),t.placeholder.on("placeholder:complete",function(){var e=t.placeholder.get("label");t.set("label",e),e.on("click",function(){t.comboBox.sendRequest("")})})},_initComboEvent:function(){var e=this,t=e.comboBox,n=t.get("input");n.on("mousedown",function(r){if(e.fire("beforeFocus")!==!1){var i=l.trim(n.val()),o=e.get("sugConfig"),a=!0;a&&(o.autoCollapsed||""===i)&&t.sendRequest(i)}r.stopPropagation()}),n.on("focus",function(){e.fire("beforeFocus")}),n.on("blur",function(){if(e.fire("beforeBlur")===!1)return!1});var r=e.get("sugConfig").itemClick,i=!0;if(r&&l.isFunction(r)){i=!1;var o=r.apply(this,arguments);o!==!1&&(i=!0)}i&&t.on("click",e.comboClick,e),t.on("afterCollapsedChange",e._addExtraEvent,e),t.on("afterCollapsedChange",function(t){e.fire("afterCollapsedChange",t)}),t.on("beforeQueryChange",function(t){e.fire("beforeQueryChange",t)}),t.on("beforeSetInputValue",function(){var t;t=e.placeholder?e.placeholder.get("label"):e.get("label"),t&&s.hide(t)}),e._formSubmitEvent(),e.query=n.val();var a=e.get("label");a&&a.on("click",function(){t.sendRequest(n.val())})},_formSubmitEvent:function(){var e,t=this,n=t.comboBox,r=n.get("input"),i=r.parent("form"),o=n.get("input");i.on("submit",function(n){if(t.fire("beforeSubmit",{el:i,isInitSearch:!0})!==!1){var r=l.trim(o.val());t.hongbaoConfig.open&&S&&""!==r?S.intercept(r,function(){t.serializeToForm(i,e)},function(){o[0].blur(),n.halt()}):(e=i.attr("action"),""===r&&t._emptyJump(i)===!1&&n.preventDefault(),t.serializeToForm(i,e))}else n.halt()})},serializeToForm:function(e,t){var n,r,i,o="",a="";if(t&&e){if(t.indexOf("?")===-1)return;if(o=t.split("?")[1]){n=o.split("&");for(var s in n)r=n[s].split("="),i=r[0],i&&!e[0][i]&&(a+='<input type="hidden" name="'+r[0]+'" value="'+r[1]+'"/>');e.append(a)}}},_defaultPageJump:function(e){var t,n=this,r=n.tabNode;if(!r)return!1;if(t=e.attr("data-defaultpage")||r.attr("data-defaultpage")){if(!/(http(s:|:))?\/\//.test(t))return!1;e.attr("action",t)}},_emptyJump:function(e){var t,n=this,r=e.one("label");return r?(t=r.one("span"),t&&""!==t.text()?(r.hide(),void n._holderJump(e,t.text())):n._defaultPageJump(e)):n._defaultPageJump(e)},_holderJump:function(e,t){var n=e[0].q;n&&(n.value=t),e.append('<input type="hidden" name="style" value="grid" />'),e.append('<input type="hidden" name="hintq" value="1" />')},_sendSnapshot:function(e){var n,r=this,i=[],o=-1,a=0,s=r.get("statConfig");if(s.unicode)for(e.selected=t(e.selected),a=0;a<e.children.length;a++)n=e.children[a],n.value=t(n.value),e.selected===n.value?o=a:i.push(n.value+"/"+n.index);else for(a=0;a<e.children.length;a++)n=e.children[a],e.selected===n.value?o=a:i.push(n.value+"/"+n.index);var u="f_stats_show=xialalist:";u+=i.join(","),u=u+";query:"+e.query,u=u+";selected:"+e.selected+"/"+o,u=u+";time:"+l.now(),u=u+";nick:"+r.getNick(),r.Stat.send(u,!0)},comboClick:function(e){var t,r=this,i=e.target.get?e.target.get("el"):n.one(e.currentTarget),o=r.comboBox,a=i.one(".item-text, .search-menu-key, .search-menu-history-key"),s=!1,u=r.get("form"),c=r.get("sugConfig").isSendByForm;if(a){t=a.text();var l=r.historyArr;if(l)for(var f=0,d=l.length-1;f<=d;f++)if(t===l[f]){s=!0;break}}for(var h=o.get("menu"),p=o.get("input"),g=h.get("children"),m=[],v=0;v<g.length;v++){var y=g[v],_=y.get("value");_&&m.push({index:v,value:_[0]})}var b={query:r.query||"",children:m,selected:t||""};if(r._sendSnapshot(b),r.fire("beforeSubmit",{el:i,isInitSearch:!1,isNotSave:s})!==!1){var g=i.children();if(g&&g[0].className.indexOf("menu-channel-entry")!==-1){var x=g.children().attr("href");return r.redirect(x),!1}var x=r.getRedirect(i);if(r.hongbaoConfig.open&&S)return S.intercept(t,function(){r.redirect(x)},function(){p[0].blur()}),!1;c?(r.serializeToForm(u,x),u[0].submit()):r.redirect(x)}},getRedirect:function(e){var t=this,n=t.query,r=t.query,i=s.children(e),o=s.attr(i,"data-key")||"q="+n,a=t.get("form")[0],u=s.attr(a,"action"),c=s.attr(i,"data-action")||t.get("action")||u,f=s.attr(i,"data-source-stat")||"source=suggest",d="&_input_charset=utf-8&wq="+encodeURIComponent(r)+"&suggest_query="+encodeURIComponent(n)+"&"+f,h=t._getInputsVal(a);c+=c.indexOf("?")>-1?"&":"?";var p=l.unparam(o),g="";if(l.isObject(p)){var m=[];for(var v in p)Object.prototype.hasOwnProperty.call(p,v)&&m.push(v+"="+encodeURIComponent(p[v]));g=m.join("&")}var y=c+h+"&"+(g||o)+d;return y},redirect:function(e){var t=this,n=t.get("sugConfig").isEncode;n?e=t.urlEncode(e):(e=e.replace(/(#)[^!]/g,function(e,t){return e.replace(t,"%23")}),e=e.replace(/#!/g,"#"));var r=document.createElement("a");r.setAttribute("href",e),r.setAttribute("target","_self"),r.style.display="none",document.body.appendChild(r),r.click()},urlEncode:function(e){var t=/[\u4e00-\u9fa5\uf900-\ufa2d+#\s]+/g.exec(e);if(t)try{e=e.replace("\uff1f","?"),e=e.replace(/[\u4e00-\u9fa5\uf900-\ufa2d+#]+/g,function(e){return encodeURIComponent(e)}),e=e.replace(/\s/g,function(){return"+"}),e+="&ie=utf-8"}catch(n){KISSY.log("url\u7f16\u7801\u51fa\u9519!")}return e},_getInputsVal:function(e){for(var t,n,r=this,i=r.get("sugConfig"),o=i.excludeParam,a=[],u=s.query("input",e),c=u.length-1;c>=0;c--)t=u[c],n=t.name,n&&!l.inArray(n,o)&&a.push(n+"="+encodeURIComponent(t.value));return a.length<1?"":"&"+a.join("&")},_getDefComboCfg:function(){return{focused:!1,hasTrigger:!1,matchElWidth:!0,srcNode:".allWidth",highlightMatchItem:!1,menu:{align:{overflow:{adjustY:0}}},cache:!0}},_prepareHtml:function(e){var t=this,r=s.get(e.node),i=r.innerHTML,o=e.prefixCls,a=s.get(e.placeholderEl),u=a?a.outerHTML:"",c='<div class="{cls}combobox"><div class="{cls}combobox-input-wrap"></div></div>',l=c.replace(/{cls}/g,o).replace(/{label}/g,u).replace(/{input}/g,i),f=s.create(l),d={"aria-haspopup":"true","aria-combobox":"list",role:"combobox",autocomplete:"off","x-webkit-grammar":"builtin:translate"};return s.addClass(r,o+"combobox-input"),s.attr(r,"aria-label")||(t._isOpen("history")?d["aria-label"]="\u8bf7\u8f93\u5165\u641c\u7d22\u6587\u5b57\u6216\u4ece\u641c\u7d22\u5386\u53f2\u4e2d\u9009\u62e9":d["aria-label"]="\u8bf7\u8f93\u5165\u641c\u7d22\u6587\u5b57"),s.attr(r,d),s.wrap(r,f),n.one("."+o+"combobox")},_isOpen:function(e){var t=this,n=t.get("mods"),r=n.sort;return l.inArray(e,r)},_getRenderMods:function(){var e=this,t=l.merge(h,e.get("mods"));e.set("mods",t)},_getDataSourceCfg:function(){var e=this,t=e.get("sugConfig"),n=e.get("dataSourceCfg"),r=t.sourceUrl;return location.href.indexOf("debug=test")>-1&&(r=r.replace("suggest.taobao.com/sug?","suggest.proxy.taobao.org/sug?")),r.indexOf("bucketid")===-1&&(r+=r.indexOf("?")===-1?"?bucketid="+e._getBucketId():"&bucketid="+e._getBucketId()),n.xhrCfg.url=r,n.parse=l.bind(e.parse,e),n},_getBucketId:function(){return(new p).getBucket()},_getComboCfg:function(e){var t=this,r=t.get("sugConfig"),i=t._getDefComboCfg(),o=r.prefixCls,a=n.one("."+o+"combobox");return a||(a=t._prepareHtml(r)),this.get("sugConfig").focused&&a.one("input")[0].focus(),i.srcNode=a,i.dataSource=e,i.format=l.bind(t.format,t),i.prefixCls=r.prefixCls,r.placeholderEl&&(i.holderEl=n.one(r.placeholderEl)),i.maxItemCount=i.maxItemCount||e.maxItemCount,i},_initCombo:function(){var e,t,n=this,r=n._getDataSourceCfg(),i=n.get("sugConfig");n._getRenderMods(),i.sourceUrl?(e=new f.RemoteDataSource(r),e.maxItemCount=10):(e=new f.LocalDataSource(r),e.maxItemCount=0),n._setComboCache(e),t=n._getComboCfg(e);var o=new f(t);o.render(),n.comboBox=o,n._checkHasTab(),n._initComboEvent()},update:function(e){for(var t=this,n=t.get("plugins"),r=0,i=n.length-1;r<=i;r++){var o=n[r];o&&l.isFunction(o.update)&&o.update.call(o,e)}},parse:function(e,t){var n,r=this,i=r.fire("beforeParse",{results:t,query:e});if(i===!1)return[[""]];if(i&&(t=i),!t||!t.result)return KISSY.log("\u63a5\u53e3\u65e0\u6570\u636e!"),[[""]];n=t.result,delete t.result;var o=r.comboBox.get("dataSource");if((o.extraData||(o.extraData=[]))[e]=t,0===n.length)return[[""]];for(var a in n)n[a]||n.splice(a,1);return n},format:function(e,t){var n=this;return n.resultArr=[],n.render(e,t),n.resultArr},render:function(e,t){var n,r,i,o,a,s,u=this,c=u.get("mods"),l=c.sort,f=u._adjustExtra(e,c.showExtra);u.query=e;for(var d=0,h=l.length-1;d<=h;d++)if(s=l[d])if("list"!==s){if(a=u.getPlugin(s),a&&a.renderPlugin)a.renderPlugin({query:e,results:t});else if(r=c[s],r&&f&&(!(o=r.pos)||i!==o)){if(n=r.tmpl,!n)continue;var p=u.resultArr.length,g=u.diffLen||0;i=u.defaultRender({tmpl:n,name:s,pos:o,always:r.always&&t.length>0,callback:r.callback,index:p-g})}}else r=c[s],n=r.tmpl,u._list(e,t,n);u.fire("afterQueryChange",{query:e})},defaultRender:function(e){var t,n=this,r=e.tmpl,i=e.name,o=n.comboBox.get("dataSource"),a=n.query,s=n.get("sugConfig").prefixCls,u=o.extraData,c=e.pos,f=e.index;if(u&&u[a]||e.always){var d,h,p=n._getDate(),g={$query:a,$queryUrl:encodeURIComponent(a),$date:p,prefixCls:s};if(!e.always){if(d=u[a][i],h=!0,!d)return;if(l.isArray(d)){d.length>2&&(d.length=2);
for(var m=0,v=d.length;m<v;m++){var y=d[m];if(l.isArray(y)){h=!1;for(var _=0,b=y.length;_<b;_++)g["$"+_]=y[_]||"";g.$3=encodeURIComponent(g.$2),g.$index=f+1+m,t=l.substitute(r,g),n.addContent({html:t,query:a,position:c,callback:e.callback})}else g["$"+m]=y,g.$index=f+1+m}return h&&(t=l.substitute(r,g),n.addContent({html:t,query:a,position:c,callback:e.callback})),c}if(l.isObject(d)){for(var x in d)g[i+"_"+x]=d[x];"active"===i&&(g.$query=d.query+" "+d.tag)}else g[i]=d,g.$query=d}return g.$index=f+1,t=l.substitute(r,g),n.addContent({html:t,query:g.$query||a,position:c,callback:e.callback}),c}},_adjustExtra:function(e){return""!==e},getNick:function(){var e=this;return e._getCookie("lgc")||e._getCookie("tracknick")},_getCookie:function(e){var t=window;if(t.userCookie&&!l.isUndefined(t.userCookie[e]))return t.userCookie[e];if(t.SRP_COOKIES||(t.SRP_COOKIES={})&&l.isUndefined(SRP_COOKIES[e])){var n=document.cookie.match("(?:^|;)\\s*"+e+"=([^;]*)");n&&n[1]?SRP_COOKIES[e]=decodeURIComponent(n[1]):SRP_COOKIES[e]=""}return SRP_COOKIES[e]},_getDate:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+(e.getDate()+1)},_list:function(e,t,n){var r,i=this,o=i.get("sugConfig").resultFormat,a=i.resultArr||(i.resultArr=[]);l.each(t,function(i,s){if(!i||!i[0])return void t.splice(s,1);var u,c=i[0],f="",d=e;if(c.match(/<b>/))r=c.replace(/<b>(\S+?)<\/b>/g,function(e,t){return t}),f=c,c="";else{for(;c.indexOf(d)<0;)d=d.substr(0,d.length-1);""===d?(f=c,c=""):0===c.indexOf(d)?(f=d,c=c.replace(d,"")):(f=c,c=""),r=i[0]}for(var h in a)if(u=a[h],u.textContent===i[0]&&u.unique)return;n=n.replace("{format}",o),a.push({textContent:r,content:l.substitute(n,{query:f,text:c,index:s+1,count:i[1],textContent:encodeURIComponent(r)}),list:!0})}),i.resultArr=a},addContent:function(e){var t=this,n=e.html,r=e.position,i=e.query;if(!r){var o=t.resultArr||[];return void o.push({content:n,textContent:i})}t["__"+r]={tmpl:n},t._addExtraEvent()},_renderHeader:function(e,t,r){var i=t&&t.type+"-header"||"";if(t){var o=this.get("sugConfig").prefixCls;e||(e=new n("<div class='"+o+"combobox-menu-header "+i+"'></div>").prependTo(r)),e.empty().append(t.tmpl)}else e&&e.remove()},_renderFooter:function(e,t,r){var i=this,o=i.get("sugConfig").prefixCls,a=t&&t.type+"-footer"||"";if(t){e||(e=new n("<div class='"+o+"combobox-menu-footer "+a+"'></div>").appendTo(r)),t.css&&e.css(t.css),e.empty().append(t.tmpl);var s=e.one("."+o+"menu-history-clean");s&&s.on("click",function(e){e.halt();var t=i.getPlugin("history");t._cleanHistory()})}else e&&e.remove()},_addExtraEvent:function(e){var t=this,n=t.comboBox||t,r=t.__header,i=t.__footer,o=t.__lastHeader,a=t.__lastFooter,s=t.get("sugConfig").prefixCls;if(!e||e&&!e.newVal){var u=n.get("menu");if(!u.get)return;var c=u.get("el");if(!c||c.all("."+s+"menuitem").length<1)return;var l=c.one("."+s+"combobox-menu-header"),f=c.one("."+s+"combobox-menu-footer");o!==r&&(t.__lastHeader=r,t._renderHeader(l,r,c)),a!==i&&(t.__lastFooter=i,t._renderFooter(f,i,c))}else t.__header=null,t.__footer=null}},{ATTRS:{sugConfig:{value:{extraPassParams:"",extraPostParams:"",sourceUrl:"",tab:"item",autoCollapsed:!0,focused:!1,prefixCls:"search-",excludeParam:["q"],resultFormat:"\u7ea6{count}\u4e2a\u5b9d\u8d1d"},setter:function(e){var t=this.get("sugConfig");return l.mix(t,e,void 0,void 0,!0)}},mods:{value:{},setter:function(e){return e}},input:{getter:function(e){return e?e:this.comboBox?e=this.comboBox.get("input"):void 0}},form:{getter:function(e){return e?e:this.get("input")?e=this.get("input").parent("form"):void 0}},label:{getter:function(e){return e?e:this.comboBox?e=this.comboBox.get("holderEl"):void 0}},menu:{getter:function(e){return e?e:this.comboBox?e=this.comboBox.get("menu"):void 0}},dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},statConfig:{value:{tongjiKey:{logkey:"/tongji",chksum:"H51884970"},pvKey:{logkey:"/search",chksum:"H51884969"},unicode:!1},setter:function(e){var t=this.get("statConfig");return l.mix(t,e,void 0,void 0,!0)}},placeholder:{value:{show:!1,node:null}}}});return e=w}(),n.exports=h});define("kg/search-suggest/6.3.1/plugin/history",["base","node","util","anim","ua","event","kg/search-suggest/6.3.1/mods/local-query"],function(e,t,i){function s(e){s.superclass.constructor.call(this,e||{})}var r=e("base"),a=e("node"),o=e("util"),n=e("anim"),l=e("ua");e("event");var u,c=e("kg/search-suggest/6.3.1/mods/local-query");o.extend(s,r,{isSupported:function(){return!l.ie},pluginInitializer:function(e){if(this.isSupported()){var t=this,i=e.get("sugConfig"),s=i.tab||"";u=e.Stat,e.set("extend",{history:!0}),t.set("caller",e),t.localQueryMap={},t.historyLocalQuery=t.localQueryMap[s]=new c({name:"history",tab:s,user:e.getNick()}),t.hitedHistoryListMap={};var r=e.comboBox,a=function n(e){if(!e.newVal){r.detach("afterCollapsedChange",n);var s=r.get("menu").get("el");s.delegate("mousedown","."+i.prefixCls+"menu-history-delete",t._historyDeleteMousedown,t)}};setTimeout(function(){t.historyLocalQuery.checkFlash({onSuccess:function(){t.historyReady=!0,r.on("afterCollapsedChange",a),e.on("beforeSubmit",function(e){var i=r.get("input").val(),s=e.isNotSave;""===o.trim(i)||i.match(/[<>'"]/g)||t.historyLocalQuery&&!s&&t.historyLocalQuery.save(i,o.trim(i))})},onFailure:function(){KISSY.log("load iframe localstorage failure!")}})},500)}},_dealUrl:function(e,t){var i="&area=history",s=e.indexOf(i)>-1;return t?!s&&e+i:s&&e.replace(i,"")},_getPinyinQuery:function(){},_renderHTML:function(e,t){var i,s=this,r=s.get("caller"),a="",n=r.get("mods").history.tmpl,t=t||{},l=r.resultArr||(r.resultArr=[]),u=[];e=o.unique(e);for(var c=0,y=e.length-1;c<=y;c++)0!==c&&(t.attr=""),t.index=(c+1).toString(),t.historyItemValue=decodeURIComponent(e[c].key),t.historyItemQuery=e[c].key,a=o.substitute(n,t),i=t.historyItemValue,u.push(i),l.push({content:a,textContent:i,unique:!0});r.historyArr=u},renderPlugin:function(){if(this.isSupported()&&this.historyReady){var e,t,i=this,s=i.get("caller"),r=s.query,a=i.historyLocalQuery.query(r),o=i.get("limit"),n=s.get("sugConfig"),l=s.comboBox.get("dataSource"),u=l.extraData&&l.extraData[r];if(i.get("web")&&""===r&&u&&u.cloud)return void i._renderHTML(u.cloud,{prefixCls:n.prefixCls});""===r&&a.length>0?(s.__header={tmpl:'<div class="history-box"><span>\u6700\u8fd1\u641c\u8fc7</span></div>',type:"history"},s.__footer=null,e=o):(s.__header=null,s.__footer=null,e=2),t=a.splice(0,e),s._addExtraEvent(),i._renderHistoryItems(t),i.hitedHistoryListMap[r]=t}},_historyDeleteMousedown:function(e){for(var t=this,i=t.get("caller"),s=a.one(e.target),r=s.parent().attr("data-value"),o=s.parent(2),n=i.comboBox,l=n.get("menu"),u=l.get("children"),c=s.attr("data-type"),y=0;y<u.length;y++){var d=u[y];if(d.get("el")[0]===o[0]){l.removeChild(d,!0);break}}var h=t.historyLocalQuery;h&&("history"===c?h.deleteItem(r):"most"===c&&(h._setKey({name:"most"}),h.save(r,r),h._setKey({name:"history"}))),n.sendRequest(i.query),t._sendStat(r)},_sendStat:function(e){var t,i=this.get("caller"),s={},r=location.hostname,a="op=del&nk={nick}&src={host}&q={query}&app=sug";s.nick=i.getNick(),s.query=e,s.host=r.replace(/com|\./g,""),t=KISSY.substitute(a,s),u&&u.send(t)},_renderHistoryItems:function(e,t){var i=this,s={},r=i.get("caller"),a=r.get("sugConfig");s.prefixCls=a.prefixCls,s.attr=t&&t.attr||"",s.extraParam=t&&t.param||"history",i._renderHTML(e,s)},_getPinyin:function(e){},_retSug:function(e){},_cleanHistory:function(){var e=this,t=e.get("caller"),i=t.comboBox,s=i.get("menu"),r=s.get("el"),a=i.get("input"),o=t.get("sugConfig"),l=o.prefixCls,u=r.one("."+l+"combobox-menu-header");e.hitedHistoryListMap={};var c=u.siblings();c.css("display","none"),u.html('<div class="history-box"><span>\u641c\u7d22\u5386\u53f2\u5df2\u6e05\u7a7a</span></div>');var y=new n(r,{opacity:0},3,"easeIn",function(){c.css("display","block"),r.css({opacity:1,visibility:"hidden"})});y.run();var d=function h(e){y.isRunning()&&y.stop(!0),t.__header=null,t.__footer=null,"keydown"===e.type&&this.value&&r.css("visibility","visible"),a.detach("blur keydown mousedown",h)};a.on("blur keydown mousedown",d)},update:function(e){if(this.isSupported()){var t=this,i=encodeURI(e.tab);t.localQueryMap[i]||(t.localQueryMap[i]=new c({name:"history",tab:i,user:t.get("caller").getNick()})),t.historyLocalQuery=t.localQueryMap[i]}}},{ATTRS:{pluginId:{value:"history"},limit:{value:10,setter:function(e){if(o.isNumber(e))return e}}}}),i.exports=s});define("kg/search-suggest/6.3.1/plugin/cloud",["base","dom","event","cookie","kg/search-suggest/6.3.1/mods/menu","kg/search-suggest/6.3.1/tpl/cloud","node","util","ua"],function(e,t,a){function i(e){i.superclass.constructor.call(this,e||{})}var n=e("base"),r=e("dom"),o=e("event");e("cookie");var s,l,u=e("kg/search-suggest/6.3.1/mods/menu"),d=e("kg/search-suggest/6.3.1/tpl/cloud"),h=e("node"),c=e("util"),g=e("ua"),m=h.all;c.extend(i,n,{pluginInitializer:function(e){var t,a,i=this,n=e.comboBox;i.isNotFirstRender=[],i.count=0,s=e,l=i.Stat,i.set("caller",e),i.initKeyEvent();var o=r.children(e.get("el")),d=e.get("form")[0],c=r.attr(d,"action"),g=r.attr(o,"data-action")||e.get("action")||c;i.set("action",g),n.on("beforeShow",function(){if(i.isShowFirstItem){var e=n.get("menu"),t=a.get("children");e.set("highlightedItem",t[0]),i.show(t[0].get("el")[0])}else i.setCloudHeight()});var m=function v(n){n.newVal||(e.detach("afterCollapsedChange",v),i.mouseArr=[],a=e.get("menu"),t=a.get("el"),t.addClass("search-cloud-menu"),i.initMenu||(h.one(".search-menu")&&(i.initMenu=!0,i.menu=new u({wrap:".search-menu",menu:".search-contentbox,.search-menu-content",rows:".search-menuitem",cls:".search-wrap-cloud",tolerance:500,handler:{enterHandler:function(t){e.fire("beforeCloudShow",{inst:i,el:t})!==!1&&i.show(t)},leaveHandler:function(e){i.hide(e)}}})),a.on("afterHighlightedItemChange",function(){i.setCloudHeight()}),i.initMouseEvent(t)))};e.on("afterCollapsedChange",m)},initMouseEvent:function(e){return!!e&&void e.delegate("click",".cloud-list a",function(e){var t=e.currentTarget,a=t.getAttribute("href");a&&(a=s.urlEncode(a),t.setAttribute("href",a))})},show:function(e){var t=this;t._showCloud(e),t.setCloudHeight()},hide:function(){this._hideCloud()},setCloudHeight:function(){var e,t=s.get("menu").get("el"),a=h.one(".cloud-footer");if(t.width()<500?t.addClass("narrow-suggest-menu"):t.removeClass("narrow-suggest-menu"),a){if(e=a.one(".cloud-box"),e.css("height","auto"),t.css("height","auto"),e){var i=t.height(),n=e.height();n>i?t.height(n-1):(t.css("height","auto"),e.css("height","100%"))}}else t.css("height","auto")},_hideCloud:function(){m(".cloud-footer").hide(),m(".search-menu-item-hover").removeClass("search-menu-item-hover")},_showCloud:function(e){var t,a,i,n=this,r=m(".search-wrap-cloud",e),o=h.one(".cloud-footer");m(".search-menu-item-hover").removeClass("search-menu-item-hover"),m(e).addClass("search-menu-item-hover"),n.lastItemIndex&&(a=h.one("#J_CloudList"+n.lastItemIndex),a&&a.hide(),o&&o.hide()),r.length&&(t=r.attr("data-index")||r.one("div").attr("data-index"),n.lastItemIndex=t,a=h.one("#J_CloudList"+t),a&&(i=a.attr("data-align"),n.set("align",!("true"!==i)),a.show(),o&&o.show(),n.setPadding(m(e),a)))},_sendStat:function(){var e="f_stats_show=magic:1",t=s.get("sugConfig").sourceUrl,a="";t&&t.match(/bucketid=\w+/)&&(a=t.match(/bucketid=(\w+)/)[1],e+=";bts:"+a),l&&l.send(e,!0)},getPadding:function(e,t){var a=32,i=h.one(".search-menu"),n=i.offset().top,r=e.offset().top,o=r-n,s=i.height(),l=t.height(),u=o-a,d=s-l-u-10;if(u>0)return d>=0?u:u-=39*Math.round(-d/39)},initKeyEvent:function(){var e=this,t=s.comboBox,a=o.KeyCodes||h.KeyCode;t.on("beforeKeyDown",function(i){var n=this.get("menu");if(n.get){var r,o,l,u,d=i.event,m=n.get("highlightedItem"),v=n.get("children"),f=v.length;if(0!==f)switch(d.keyCode){case a.ENTER:var p=e.isShowMagic(),w=e.isShowItem(),y=p||w;return y&&(d.halt(),!p&&w&&(g.ie>=10||0===KISSY.version.indexOf("6."))?m.fire("click"):y.click()),!1;case a.UP:case a.DOWN:var k,C;d.keyCode===a.UP?(C=f-1,k=-1):(C=0,k=1),e.isTriggerArrowKey=!0,m?(r=c.indexOf(m,v),o=(r+k+f)%f):o=C;var x=h.one(".cloud-link-wrap-hover");return x&&x.removeClass("cloud-link-wrap-hover"),0===r&&k===-1||r===f-1&&1===k?(e._hideCloud(),n.set("highlightedItem",null),t._stopNotify=1,s.get("input").val(t._savedInputValue||t._savedValue),!1):(l=n._getNextEnabledHighlighted(o,k),n.set("highlightedItem",l),e.show(l.get("el")[0]),t._stopNotify=1,u=l.get("textContent"),t.setValueFromAutocomplete?t.setValueFromAutocomplete(u):(t._stopNotify=1,s.get("input").val(u)),t.fire("beforeSetInputValue",{event:d}),!1);case a.HOME:case a.END:return l=d.keyCode===a.END?n._getNextEnabledHighlighted(f-1,-1):n._getNextEnabledHighlighted(0,1),n.set("highlightedItem",l),e._showCloud(l.get("el")[0]),t.setValueFromAutocomplete?t.setValueFromAutocomplete(l.get("textContent")):(t._stopNotify=1,s.get("input").val(l.get("textContent"))),!1;default:e.directionEvent(d)}}})},isShowMagic:function(){var e,t,a,i=m(".J_cloud-handle");if(i.each(function(t){var a=h.all(t);"none"!==r.css(a,"display")&&(e=a)}),e)return t=r.query(".cloud-link-wrap-hover")[0],t&&(a="a"===t.tagName.toLowerCase()?t:r.query("a",t)[0]),a},isShowItem:function(){var e=this;return e.isTriggerArrowKey&&r.get(".search-menu-item-hover")},directionEvent:function(e){var t,a,i,n,r,o=this;switch(e.keyCode){case 39:case 37:if(r=s.get("menu"),t=r.get("activeItem")||r.get("highlightedItem"),!t)return!0;if(a=t.get("el").one(".item-wrapper"),!a)return!0;if(i=a.attr("data-index"),!i)return!0;if(n=h.one("#J_CloudList"+i),!n)return!0;var l=e.keyCode-37?"next":"prev";o.getHighLightItem(n,l)}},getHighLightItem:function(e,t){var a=e.one(".cloud-link-wrap-hover");if(a){var i=parseInt(e.attr("data-select-index")),n=e.all(".cloud-link");i="next"===t?i<n.length-1?i+1:0:i>0?i-1:n.length-1,a.removeClass(".cloud-link-wrap-hover");var r=n.item(i);e.attr("data-select-index",i),r.parent().addClass("cloud-link-wrap-hover")}else{var o=e.one(".cloud-link").parent();o&&o.addClass("cloud-link-wrap-hover"),e.attr("data-select-index",0)}},setPadding:function(e,t){var a=this,i=t.one(".inner-wrap"),n=this.getPadding(e,i),r=a.get("align");r&&n&&i.css("paddingTop",n)},checkRender:function(e){var t,a=this,i=e.comboBox,n=e.query,r=i.get("dataSource"),o=r.extraData[n],s=e.resultArr;return t=!(""===n||!o)&&{extra:o,query:n,results:s},a.extraData=o,a.isShowFirstItem=!1,t},isAutoShow:function(e){return!!(c.isArray(e)&&e.length>0&&(e[0].list||e[0].tag))},renderPlugin:function(){var e=this,t=e.checkRender(s);if(!t)return!1;var a,i,n,r,o,l,u,d,h="",m=t.extra,v=t.results,f=t.query;e.isFirstShow=!1,a=c.clone(m.magic);for(var p=e.isAutoShow(s.resultArr),w=0,y=v.length-1;w<=y;w++)if(i=v[w],o=i.content,n=o.match(/data-index='(\w+)'/),r=o.match(/data-key='([\S\s]+?)'/),n&&n[1]){n=n[1]-0,r&&r[1]&&(r=r[1]);for(var k in a)l=a[k],n===l.index-0&&(e._wrapItem(i,r),d=e._renderHTML({data:l,query:f,index:n,key:r,auto:p,type:l.type||"tag",tagTitle:decodeURIComponent(r.match(/q=([^&]+)/)[1]),action:e.get("action")}),d&&(h+=d),1===n&&d&&(u=!0))}var C={tmpl:'<div class="cloud-box">'+h+"</div>",type:"cloud"};if(p&&u?(C.css={display:"block"},e.isShowFirstItem=!0):(C.css={display:"none"},e.isShowFirstItem=!1),g.ie<7){var x=s.resultArr.length;C.css.height=26*x}s.__footer=C,s._addExtraEvent(),e.isTriggerArrowKey=!1},_wrapItem:function(e,t){var a;c.isObject(e)&&(a=e.content,e.content="<div class='search-wrap-cloud' data-key='"+t+"'>"+a+"</div>")},_renderHTML:function(e){var t,a,i,n=this,r={},o=e.data,s=e.query,l=e.index,u=n.extraData,d=e.type,h=e.auto&&1===l?"style='display:block'":"";if(u&&u.event&&1===l)t=n.get("event-tmpl"),a=n.get("event-param");else{if(!d)return KISSY.log("\u9b54\u76d2\u7c7b\u578b\u4e0d\u5b58\u5728!"),h="",!1;if(i=n.get(d),!i)return KISSY.log("\u63a5\u53e3\u8fd4\u56de\u7684\u7c7b\u578b"+d+"\u4e0d\u5b58\u5728\u5bf9\u5e94\u7684\u6a21\u677f"),h="",!1;t=i.tmpl,i.length&&o.data&&o.data.length>i.length&&(o.data.length=i.length),i.sort&&n.sort(o.data),a=n.get("param")}r.param=a?"&"+a:"",r.query=s,r.index=l,r.prefix=e.prefix||l,r.tagTitle=e.tagTitle,r.action=e.action,o.count&&o.count<=3&&(r.ishidden="hidden"),r=c.merge(r,o),r.autoAttr=h;var g=t(r);return g},sort:function(e){Array.prototype.sort.call(e,function(){return Math.random()>.5?-1:1})}},{ATTRS:{pluginId:{value:"cloud"},limit:{value:3,setter:function(e){if(c.isNumber(e))return e}},tag:{value:{tmpl:d.tag,sort:!0,length:10}},tag_group:{value:{tmpl:d.tag_group,length:10}},navi:{value:{tmpl:d.navi}},spu:{value:{tmpl:d.spu,length:3}},topbrand:{value:{tmpl:d.topbrand}},qrcode:{value:{tmpl:d.qrcode}},align:{value:!0}}}),a.exports=i});define("kg/search-suggest/6.3.1/plugin/tab",["node","base","dom","util","event","kg/combobox/6.2.7/index"],function(t,a,o){function e(t){e.superclass.constructor.call(this,t||{})}var s=t("node"),i=t("base"),r=t("dom"),l=t("util"),n=t("event"),c=t("kg/combobox/6.2.7/index");l.extend(e,i,{pluginInitializer:function(t){this.tabConfig={},this._initPluginEvent.call(this,t)},tabClick:function(t){var a,o,e=this,i=e.get("caller"),l=t.currentTarget,n=r.attr(l,"data-searchtype"),c=r.attr(l,"data-defaultpage"),g=r.attr(l,"data-action"),u=i.comboBox.get("input"),f=r.parent(u,"form"),b=e.get("activeCls"),d=r.get("label",f),m=e.tabConfig;if(i.fire("beforeTabChange",{el:l,labelType:n})===!1)return!1;if(r.removeClass(r.siblings(l),b),r.addClass(l,b),i.tabNode=s.one(l),c&&f.setAttribute("data-defaultpage",c),g&&f.setAttribute("action",g),n){if(o=m[n]||e.getDefCfg(n),!o)return!1;g&&(o.action=g),i.update(o),e.tabConfig&&!e.tabConfig[n]&&e.saveTabConfig(o)}else{var C=i.query||u.val(),h=r.get("a",l);if(h){var p=r.attr(h,"href");p=p.replace("/?","/search?"),p=p+"&q="+C,r.attr(h,"href",p)}}d&&(a=d.getAttribute("data-searchtype-"+n)||"",d.innerHTML=a),t.preventDefault()},_initPluginEvent:function(t){var a=this,o=a.get("activeCls"),e=a.get("node")||t.get("sugConfig").tablist;a.set("caller",t),e&&(n.on(e,"click",a.tabClick,a),s.all(e).each(function(a){var e=s.all(a);e.hasClass(o)&&(t.tabNode=e)}),a.saveTabConfig())},saveTabConfig:function(t){var a,o,e=this,s=e.get("caller"),i=s.get("form");a=s.tabNode?s.tabNode.attr("data-searchtype"):"item",o=s.userConfig||{},o.mods=s.get("mods"),o.tab=a,o.action=i.attr("action"),o.defaultpage=i.attr("data-defaultpage"),e.tabConfig||(e.tabConfig={}),e.tabConfig[a]=l.clone(o),t&&t.sugConfig&&t.sugConfig.sourceUrl&&e.tabConfig[a].sugConfig&&(e.tabConfig[a].sugConfig.sourceUrl=t.sugConfig.sourceUrl,e.tabConfig[a].tab=a)},update:function(t){var a,o,e=this,s=e.get("caller"),i=s.comboBox,l=t.tab,n=s.configArr[l],g=t.sugConfig,u=i.get("input"),f=r.parent(u,"form");s.configArr=s.configArr||[],a=s.get("dataSourceCfg"),o=a.xhrCfg,o.url=g.sourceUrl,s.__attrVals.mods.sort=t.mods.sort,n||(n=""===o.url?s.configArr[l]={data:new c.LocalDataSource({data:{},parse:a.parse})}:s.configArr[l]={data:new c.RemoteDataSource(a)}),i.set("maxItemCount",o.url?10:0),i.set("dataSource",n.data),f&&r.attr(f,"action",t.action),u[0].focus();var b=u.val();b&&i.sendRequest(b)},getDefCfg:function(t){var a;switch(t){case"shop":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=ssrch&k=1",resultFormat:"",tab:"shop",excludeParam:["q"]},mods:{sort:["history","list"],showExtra:!1},action:location.protocol+"//shopsearch.taobao.com/search",tab:"shop"};break;case"item":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:"item",excludeParam:["q"]},mods:{sort:["history","cat","global","list","shop"]},tab:"item",action:location.protocol+"//s.taobao.com/search"};break;case"mall":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=b2c&k=1",resultFormat:"",tab:"mall",excludeParam:["q"]},mods:{sort:["history","cat","global","list"]},tab:"mall",action:location.protocol+"//list.tmall.com/search_product.htm"};break;default:l.isObject(t)?(a=t,a.sugConfig||(a.sugConfig={})):l.isString(t)&&(a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:t,excludeParam:["q"]},mods:{sort:["history","list"]},action:null})}return a.sugConfig&&!a.sugConfig.tab&&(a.sugConfig.tab=a.sugConfig.sourceUrl),a}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),o.exports=e});define("kg/search-suggest/6.3.1/plugin/history-magic",["base","dom","io","kg/search-suggest/6.3.1/mods/bts","util"],function(t,e,a){function i(t){i.superclass.constructor.call(this,t||{})}var s=t("base"),o=t("dom"),r=t("io"),u=t("kg/search-suggest/6.3.1/mods/bts"),n=t("util");n.extend(i,s,{pluginInitializer:function(t){var e=this,a=t.getPlugin("cloud"),i=500;this.sug=t,e.set("cloudPlugin",a),e.set("caller",t);var s;t.on("afterQueryChange",function(){s&&clearTimeout(s),e.isGetData&&(i=0),s=setTimeout(function(){var i=t.get("menu").get("el");e.getPostData(i,function(t){if(t){var e=o.get(".search-menuitem");a.show(e)}})},i)})},getPostData:function(t,e){var a=this,i=".search-menu-history-key",s=o.query(i,t),r=o.query(".search-menu-extras-history",t),u=[],n=[],l=[],c=a.historyData||{},g=!0;if(!s)return!0;for(var d=0,h=r.length-1;d<=h;d++){var f=o.text(s[d]);u.push(o.attr(r[d],"data-index")),c[f]?c[f].index=d+1:(n.push(f),c[f]={}),l.push(f)}a.historyData=c,0===n.length&&(g=!1);var y,v={text:l,index:u,el:r,result:{content:o.outerHTML(t)}};if(g)y=a.getMagicData(v,function(t){e.call(this,t)});else{var x=a.getLocalData(l);a.render(v,x,function(t){e.call(this,t)})}return y},getLocalData:function(t){for(var e,a={},i=this.historyData,s=0;s<t.length;s++)e=t[s],a[e]=i[e];return a},getMagicData:function(t,e){var a=this,i=t.text,s=a.get("dataUrl"),o=s.replace("{query}",i.join("%01"));o.indexOf("bucketid")===-1&&(o+="&bucketid="+(new u).getBucket()),r.jsonp(o,function(i){a.isGetData=!0,a.render(t,i.magic,e,!0)})},render:function(t,e,a){var i,s,r,u,l=this,c=l.get("cloudPlugin"),g=t.text,d=t.index,h=t.el,f=!1;if(!e)return!0;l.checkCloudBox();for(var y in e){var v=e[y],x=v.index-0;v.data&&(s="_his_"+x,u=n.indexOf(s,d),r=g[u]||y,l.historyData[r]=e[y],u>-1&&o.addClass(h[u],"search-wrap-cloud"),i=c._renderHTML({result:t.result,data:e[y],query:r,index:s,key:r,auto:!1,type:e[y].type||"tag",tagTitle:r,prefix:s,action:l.sug.userConfig&&l.sug.userConfig.action}),o.get("#J_CloudList"+s)&&o.remove("#J_CloudList"+s),o.append(o.create(i),".cloud-box"),1===x&&(f=!0))}a.call(this,f)},checkCloudBox:function(){var t=this.get("caller"),e=t.get("menu").get("el");if(e&&!o.get(".cloud-box")){var a='<div class="search-combobox-menu-footer cloud-footer"><div class="cloud-box" style="height: auto"></div></div>';e.append(a)}},update:function(){}},{ATTRS:{pluginId:{value:"historyMagic"},dataUrl:{value:location.protocol+"//suggest.taobao.com/sug?area=history_magic&q={query}"},cloudPlugin:{value:null}}}),a.exports=i});define("kg/search-suggest/6.3.1/plugin/imgsearch",["node","base","util","kg/uploader/6.2.13/index","kg/uploader/6.2.13/plugins/auth/auth","kg/uploader/6.2.13/plugins/filedrop/filedrop","kg/search-suggest/6.3.1/mods/stat"],function(e,a,o){var n=e("node"),t=e("base"),i=e("util"),r=e("kg/uploader/6.2.13/index"),l=e("kg/uploader/6.2.13/plugins/auth/auth"),s=e("kg/uploader/6.2.13/plugins/filedrop/filedrop"),u=e("kg/search-suggest/6.3.1/mods/stat"),d=new u;o.exports=t.extend({initializer:function(){},pluginInitializer:function(e){var a=this;a.sug=e;var o=a.comboBox=e.comboBox,n=o.get("prefixCls"),t=a.wrap=o.$el.one("."+n+"combobox-input-wrap");t&&t.length>0&&a._renderImgsearch()},_renderImgsearch:function(){var e=this,a=n.one(e.get("query")),o=a.parent("form"),t=n.one(e.get("panel"));e._panelNode=t,e._formNode=o,e._initUploader(),e._bindEvent(),e._bindTabChange()},_initUploader:function(){var e=this,a={max:3,maxSize:5120,allowRepeat:!1,required:!0},o=e.get("authConfig");o=i.merge(a,o);var n=e.get("uploadUrl"),t=e.get("type"),u={action:n,type:t,btnTpl:'<a target="_self" href="javascript:void(0)" class="g-u ks-uploader-button"><span class="btn-text">{text}</span></a>'};"iframe"===t&&(u.data={cross:"taobao"});var p=new r(e.get("input"),u),c=e.get("theme");if(!c)throw new Error("\u7f3a\u5c11\u4e3b\u9898");e._panelNode.on("click",function(e){e.target&&"INPUT"===e.target.tagName.toUpperCase()&&d.send("f_stats_show=ps_upload:2",!0)}),p.theme(c),p.plug(new l(o)).plug(new s),p.on("select",function(){if(e.sug.fire("beforeImageSelect")===!1)return!1});var m=function(a){if(e.oldDomain&&(document.domain=e.oldDomain),!a)return!1;var o=a.result&&a.result.errorCode||0;d.send("f_stats_show=ps_upsucc:"+o,!0),e.sug.fire("beforeImageError",{data:a})};p.on("start",function(){if("iframe"===e.get("type")){e.oldDomain=document.domain||location.host;try{document.domain="taobao.com"}catch(a){m();var o=p.get("theme")._errorHandler();o&&"function"==typeof o&&o()}}}),p.on("success",function(a){return d.send("f_stats_show=ps_upsucc:1",!0),e.sug.fire("beforeImageSuccess",{data:a})!==!1&&(e._formNode.all("input[name=tfsid]").remove(),e._formNode.all("input[name=app]").remove(),e._formNode.append('<input type="hidden" name="tfsid" value="'+a.result.name+'" />'),e._formNode.append('<input type="hidden" name="app" value="imgsearch" />'),void e._formNode[0].submit())});var g=p.getPlugin("auth");return!!g&&(p.on("error",m),void p.on("cancel",function(){e.oldDomain&&(document.domain=e.oldDomain)}))},_bindEvent:function(){var e=this,a=e.comboBox.get("prefixCls");e._panelNode.on("mouseenter",function(){e._panelNode.addClass(a+"imgsearch-panel-hover")}),e._panelNode.on("mouseleave",function(){e._panelNode.removeClass(a+"imgsearch-panel-hover")})},_bindTabChange:function(){var e=this;e.sug.on("beforeTabChange",function(a){var o=a.labelType;"item"!==o?e.available(!1):e.available(!0)})},available:function(e){var a=this;e?a._panelNode.show():a._panelNode.hide()}},{ATTRS:{pluginId:{value:"imgSearch"},panel:{value:"#J_UploaderPanel"},uploadUrl:{value:"//s.taobao.com/image"},input:{value:"#J_IMGSeachUploadBtn"},query:{value:"#q"},authConfig:{value:{}},theme:{value:null},type:{value:"auto"}}})});define("kg/search-suggest/6.3.1/theme/pailitao/index",["node","kg/uploader/6.2.13/theme","ua","kg/search-suggest/6.3.1/theme/pailitao/index.css"],function(e,a,s){function i(e){i.superclass.constructor.call(this,e)}var o=e("node"),t=e("kg/uploader/6.2.13/theme"),l=e("ua");e("kg/search-suggest/6.3.1/theme/pailitao/index.css"),KISSY.extend(i,t,{render:function(){var e=this,a=e.get("uploader");a.set("theme",e),e._addThemeCssName(),e._tplFormHtml();var s=e.get("queueTarget");if(!s)throw new Error("\u62cd\u7acb\u6dd8\u4e3b\u9898 queueTarget \u672a\u8bbe\u7f6e!");if(e._rootNode=o.all(s),0===e._rootNode.length)throw new Error("\u62cd\u7acb\u6dd8\u4e3b\u9898 queueTarget ("+s+") \u8282\u70b9\u4f4d\u627e\u5230!");var i=e.get("formNode");if(e._formNode=o.all(i),0===e._formNode.length)throw new Error("\u62cd\u7acb\u6dd8\u4e3b\u9898 formNode ("+i+") \u8282\u70b9\u672a\u627e\u5230!");var t=e.get("qNode");if(e._qNode=e._formNode.one(t),!e._qNode)throw new Error("\u62cd\u7acb\u6dd8\u4e3b\u9898 qNode ("+t+") \u8282\u70b9\u672a\u627e\u5230!");e._qNode.on("focus",function(){e._hasMessageState&&e.hideMessage()}),8!==l.ie&&e._rootNode.on("focusout",function(){e._hasMessageState&&e.hideMessage()}),e._bind()},_appendFileDom:function(){return!1},_startHandler:function(){var e=this;e.showMessage("loading","<span>\u6b63\u5728\u4e0a\u4f20\u56fe\u7247\uff0c\u8bf7\u7a0d\u540e...</span>")},_progressHandler:function(){},_errorHandler:function(e){var a=this,s="\u4e0a\u4f20\u5931\u8d25";e&&"maxSize"===e.rule&&(e.result={errorMsg:"\u56fe\u7247\u4e0d\u80fd\u5927\u4e8e5M",errorInfo:"\u8bf7\u6362\u5f20\u56fe\u7247\u8bd5\u8bd5"}),e||(e={}),e.result||(e.result={});var i=e.result.errorMsg||"\u8bf7\u91cd\u65b0\u4e0a\u4f20\u8bd5\u8bd5",o=e.result.errorInfo||"";a.showMessage("error",s,i,o)},_completeHandler:function(){},showMessage:function(e,a,s,i){var o=this,t=o.get(e+"Tpl")||o.get("fileTpl"),l=KISSY.substitute(t,{title:a,msg:s||"",info:i||""});o._rootNode.html(l),o._rootNode.attr("tabindex",-1),o._rootNode.css("display","block");var r=o._rootNode.width();r<320?o._rootNode.addClass("imgseach-pailitao-theme-noicon"):o._rootNode.removeClass("imgseach-pailitao-theme-noicon"),o._rootNode[0].focus(),"error"===e&&(o._hasMessageState=!0,o.delayHideMessage(4))},delayHideMessage:function(e){var a=this;a.cleanDelayTimer(),a._delayTimer=setTimeout(function(){a.hideMessage()},1e3*e)},hideMessage:function(){var e=this;e._hasMessageState===!0&&(e._hasMessageState=!1),e._rootNode.css("display","none"),e.cleanDelayTimer()},cleanDelayTimer:function(){var e=this;e._delayTimer&&(clearTimeout(e._delayTimer),e._delayTimer=null)}},{ATTRS:{formNode:{value:"#J_SearchForm"},qNode:{value:"#q"},name:{value:"imgseach-pailitao-theme"},loadingTpl:{value:'<div class="pailitao-message pailitao-message-loading"><div class="pailitao-message-content"><div class="title" id="J_pailitaoMessageTitle">{title}</div></div></div>'},errorTpl:{value:'<div class="pailitao-message pailitao-message-error"><div class="pailitao-message-content"><div class="title" id="J_pailitaoMessageTitle">{title}</div><p class="msg">{msg}</p><p class="info">{info}</p></div></div>'},fileTpl:{value:'<div class="pailitao-message"><div class="pailitao-message-content"><div class="title" id="J_pailitaoMessageTitle">{title}</div><p class="msg">{msg}</p><p class="info">{info}</p></div></div>'},allowExts:{value:"jpg,png,gif,jpeg"},authMsg:{value:{max:"\u6bcf\u6b21\u6700\u591a\u4e0a\u4f20{max}\u4e2a\u6587\u4ef6\uff01",maxSize:"\u56fe\u7247\u4e0d\u80fd\u5927\u4e8e5M",widthHeight:"\u56fe\u7247\u5bbd\u9ad8\u9700\u5927\u4e8e200",required:"\u81f3\u5c11\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\uff01",allowExts:"\u4e0d\u652f\u6301{ext}\u683c\u5f0f\uff01",allowRepeat:"\u8be5\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\uff01"}}}}),s.exports=i});